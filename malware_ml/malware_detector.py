#!/usr/bin/env python3
import json

from malware_ml.model import load_model, apply_model_to_json
from malware_ml.prepare_data import TARGET
from malware_ml.database import DBLog


def main():
    print('Send json string to get prediction.')
    print('Send \'stop\' string to finish.')
    model = load_model()
    db_log = DBLog()
    while True:
        input_string = input()
        if input_string == 'stop':
            break
        data = json.loads(input_string)
        target = data.get(TARGET)
        prediction = apply_model_to_json(model, data)
        print(prediction)
        db_log.insert(prediction, target)


if __name__ == '__main__':
    main()
