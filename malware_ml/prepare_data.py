from catboost import Pool
import pandas as pd

CATEGORICAL_FEATURES = [
    'Machine',
    'SizeOfOptionalHeader',
    'Characteristics',
    'MajorLinkerVersion',
    'MinorLinkerVersion',
    'AddressOfEntryPoint',
    'BaseOfCode',
    'BaseOfData',
    'ImageBase',
    'SectionAlignment',
    'FileAlignment',
    'MajorOperatingSystemVersion',
    'MinorOperatingSystemVersion',
    'MajorImageVersion',
    'MinorImageVersion',
    'MajorSubsystemVersion',
    'MinorSubsystemVersion',
    'CheckSum',
    'Subsystem',
    'DllCharacteristics',
    'SectionsNb',
    'ImportsNbDLL',
    'ImportsNb',
    'ImportsNbOrdinal',
    'ExportNb',
    'ResourcesNb',
]
NUMERIC_FEATURES = [
    'SizeOfCode',
    'SizeOfInitializedData',
    'SizeOfUninitializedData',
    'SizeOfImage',
    'SizeOfHeaders',
    'SizeOfStackReserve',
    'SizeOfStackCommit',
    'SizeOfHeapReserve',
    'SizeOfHeapCommit',
    'SectionsMeanEntropy',
    'SectionsMinEntropy',
    'SectionsMaxEntropy',
    'SectionsMeanRawsize',
    'SectionsMinRawsize',
    'SectionMaxRawsize',
    'SectionsMeanVirtualsize',
    'SectionsMinVirtualsize',
    'SectionMaxVirtualsize',
    'ResourcesMeanEntropy',
    'ResourcesMinEntropy',
    'ResourcesMaxEntropy',
    'ResourcesMeanSize',
    'ResourcesMinSize',
    'ResourcesMaxSize',
    'LoadConfigurationSize',
    'VersionInformationSize',
]
TARGET = 'legitimate'


def df_to_pool(df):
    columns = NUMERIC_FEATURES + CATEGORICAL_FEATURES
    target = None
    if TARGET in df.columns:
        target = df[TARGET]
    df = df[columns].copy()
    for col in CATEGORICAL_FEATURES:
        df.loc[:, col] = df[col].fillna(-1).apply(lambda x: str(x))
    return Pool(
            df,
            label=target,
            cat_features=CATEGORICAL_FEATURES,
        )


def json_to_pool(json_data):
    df = pd.DataFrame(json_data, index=[0])
    return df_to_pool(df)
