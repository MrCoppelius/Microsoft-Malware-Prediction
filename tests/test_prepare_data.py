import pytest
import pandas as pd

from malware_ml.prepare_data import df_to_pool


PARAMETER_LIST = [
    (
        pd.DataFrame({'cat': ['a', 'b'], 'num': [1, 0.5]}),
        ['cat'],
        ['num'],
        'target',
    ),
    (
        pd.DataFrame({'cat': ['a', 'b'],
                      'num': [1, 0.5],
                      'target': [0, 1],
                      }),
        ['cat'],
        ['num'],
        'target',
    ),
    (
        pd.DataFrame({'num_1': [2, -1],
                      'num_2': [1, 0.5],
                      'target': [0, 1],
                      }),
        [],
        ['num_1', 'num_2'],
        'target',
    )
]
PARAMETER_NAMES = ','.join([
    'df',
    'cat_features',
    'num_features',
    'target',
])


@pytest.mark.parametrize(PARAMETER_NAMES, PARAMETER_LIST)
def test_df_to_pool(df, cat_features, num_features, target):
    pool = df_to_pool(
        df=df,
        numeric_features=num_features,
        categorical_features=cat_features,
        target_column=target)
    features_num = len([col for col in df.columns if col != target])
    assert pool.num_col() == features_num
    if target in df.columns:
        assert all(pool.get_label() == df[target].values)
